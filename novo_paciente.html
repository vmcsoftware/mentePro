<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novo Paciente - mentePro</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos específicos para o formulário de paciente */
        .form-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .form-header {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .form-title {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .form-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .patient-form {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .form-section {
            padding: 2rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title i {
            color: #667eea;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .form-grid.single-column {
            grid-template-columns: 1fr;
        }

        .form-grid.two-columns {
            grid-template-columns: 1fr 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-weight: 500;
            color: #333;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .required {
            color: #e74c3c;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input.error,
        .form-group select.error,
        .form-group textarea.error {
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: none;
        }

        .form-actions {
            background: #f8f9fa;
            padding: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-save,
        .btn-cancel {
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-save:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #5a6268;
            color: white;
            transform: translateY(-2px);
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            z-index: 1;
        }

        .input-with-icon input {
            padding-left: 3rem;
        }

        .photo-upload {
            border: 2px dashed #e1e5e9;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fafbfc;
        }

        .photo-upload:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .photo-upload.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .photo-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            margin: 0 auto 1rem;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .upload-text {
            color: #666;
            margin-bottom: 1rem;
        }

        .upload-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .upload-button:hover {
            background: #5a6fd8;
        }

        .progress-steps {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            background: #f8f9fa;
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .step.active {
            background: #667eea;
            color: white;
        }

        .step.completed {
            background: #2ecc71;
            color: white;
        }

        .step-connector {
            width: 30px;
            height: 2px;
            background: #e1e5e9;
        }

        .step-connector.active {
            background: #667eea;
        }

        .helper-text {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.25rem;
            font-style: italic;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }

        .emergency-contact-section {
            background: #fff9e6;
            border: 1px solid #ffe066;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .emergency-contact-section .section-title {
            color: #d68910;
        }

        /* Validação visual */
        .form-group.valid input,
        .form-group.valid select,
        .form-group.valid textarea {
            border-color: #2ecc71;
        }

        .form-group.invalid input,
        .form-group.invalid select,
        .form-group.invalid textarea {
            border-color: #e74c3c;
        }

        .validation-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
        }

        .validation-icon.valid {
            color: #2ecc71;
        }

        .validation-icon.invalid {
            color: #e74c3c;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-container {
                padding: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-grid.two-columns {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .progress-steps {
                flex-direction: column;
                gap: 0.5rem;
            }

            .step-connector {
                width: 2px;
                height: 20px;
            }

            .form-section {
                padding: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .form-title {
                font-size: 1.5rem;
            }

            .section-title {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo-section">
                <img src="assets/logo.png" alt="MentePro Logo" class="logo-img">
                <h1>mentePro</h1>
            </div>
            <nav class="nav-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    Início
                </a>
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-chart-dashboard"></i>
                    Dashboard
                </a>
                <a href="pacientes.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    Pacientes
                </a>
                <a href="agendamentos.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i>
                    Agendamentos
                </a>
                <a href="pagamentos.html" class="nav-link">
                    <i class="fas fa-money-bill-wave"></i>
                    Pagamentos
                </a>
                <a href="prontuarios.html" class="nav-link">
                    <i class="fas fa-file-medical"></i>
                    Prontuários
                </a>
                <a href="novo_paciente.html" class="nav-link active">
                    <i class="fas fa-user-plus"></i>
                    Novo Paciente
                </a>
            </nav>
            <div class="user-section">
                <div class="user-info" id="userInfo">
                    <span id="userName">Carregando...</span>
                    <button id="logoutBtn" class="btn-logout">
                        <i class="fas fa-sign-out-alt"></i>
                        Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="form-container">
            <!-- Header do formulário -->
            <div class="form-header">
                <h1 class="form-title" id="formTitle">
                    <i class="fas fa-user-plus"></i>
                    Cadastrar Novo Paciente
                </h1>
                <p class="form-subtitle" id="formSubtitle">
                    Preencha as informações abaixo para cadastrar um novo paciente no sistema
                </p>
            </div>

            <!-- Indicador de progresso -->
            <div class="progress-steps">
                <div class="step active">
                    <i class="fas fa-user"></i>
                    Dados Pessoais
                </div>
                <div class="step-connector active"></div>
                <div class="step">
                    <i class="fas fa-map-marker-alt"></i>
                    Contato
                </div>
                <div class="step-connector"></div>
                <div class="step">
                    <i class="fas fa-phone"></i>
                    Emergência
                </div>
                <div class="step-connector"></div>
                <div class="step">
                    <i class="fas fa-notes-medical"></i>
                    Observações
                </div>
            </div>

            <!-- Mensagem de sucesso -->
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i>
                Paciente cadastrado com sucesso!
            </div>

            <!-- Formulário -->
            <form id="patientForm" class="patient-form" novalidate>
                <!-- Seção 1: Dados Pessoais -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-user"></i>
                        Dados Pessoais
                    </h2>
                    
                    <div class="form-grid">
                        <!-- Upload de foto -->
                        <div class="form-group">
                            <label>Foto do Paciente (Opcional)</label>
                            <div class="photo-upload" id="photoUpload">
                                <div class="photo-preview" id="photoPreview">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <div class="upload-text">Clique ou arraste uma foto aqui</div>
                                <button type="button" class="upload-button">
                                    <i class="fas fa-upload"></i>
                                    Escolher Arquivo
                                </button>
                                <input type="file" id="photoInput" accept="image/*" style="display: none;">
                            </div>
                        </div>

                        <!-- Nome completo -->
                        <div class="form-group">
                            <label for="name">
                                Nome Completo <span class="required">*</span>
                            </label>
                            <div class="input-with-icon">
                                <i class="fas fa-user"></i>
                                <input type="text" id="name" name="name" required 
                                       placeholder="Digite o nome completo do paciente">
                            </div>
                            <div class="error-message" id="nameError"></div>
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label for="email">
                                E-mail <span class="required">*</span>
                            </label>
                            <div class="input-with-icon">
                                <i class="fas fa-envelope"></i>
                                <input type="email" id="email" name="email" required 
                                       placeholder="exemplo@email.com">
                            </div>
                            <div class="error-message" id="emailError"></div>
                        </div>

                        <!-- Telefone -->
                        <div class="form-group">
                            <label for="phone">
                                Telefone <span class="required">*</span>
                            </label>
                            <div class="input-with-icon">
                                <i class="fas fa-phone"></i>
                                <input type="tel" id="phone" name="phone" required 
                                       placeholder="(11) 99999-9999">
                            </div>
                            <div class="error-message" id="phoneError"></div>
                        </div>

                        <!-- Data de nascimento -->
                        <div class="form-group">
                            <label for="birthDate">
                                Data de Nascimento <span class="required">*</span>
                            </label>
                            <div class="input-with-icon">
                                <i class="fas fa-birthday-cake"></i>
                                <input type="date" id="birthDate" name="birthDate" required>
                            </div>
                            <div class="error-message" id="birthDateError"></div>
                        </div>

                        <!-- Gênero -->
                        <div class="form-group">
                            <label for="gender">Gênero</label>
                            <select id="gender" name="gender">
                                <option value="">Selecione...</option>
                                <option value="masculino">Masculino</option>
                                <option value="feminino">Feminino</option>
                                <option value="outro">Outro</option>
                                <option value="nao-informar">Prefiro não informar</option>
                            </select>
                        </div>

                        <!-- CPF -->
                        <div class="form-group">
                            <label for="cpf">CPF</label>
                            <div class="input-with-icon">
                                <i class="fas fa-id-card"></i>
                                <input type="text" id="cpf" name="cpf" 
                                       placeholder="000.000.000-00">
                            </div>
                            <div class="helper-text">Apenas números, sem pontos ou traços</div>
                        </div>
                    </div>
                </div>

                <!-- Seção 2: Endereço e Contato -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Endereço e Contato
                    </h2>
                    
                    <div class="form-grid">
                        <!-- CEP -->
                        <div class="form-group">
                            <label for="cep">CEP</label>
                            <div class="input-with-icon">
                                <i class="fas fa-map-pin"></i>
                                <input type="text" id="cep" name="cep" 
                                       placeholder="00000-000">
                            </div>
                            <div class="helper-text">Digite o CEP para preenchimento automático</div>
                        </div>

                        <!-- Endereço -->
                        <div class="form-group full-width">
                            <label for="address">
                                Endereço Completo <span class="required">*</span>
                            </label>
                            <div class="input-with-icon">
                                <i class="fas fa-home"></i>
                                <input type="text" id="address" name="address" required 
                                       placeholder="Rua, número, complemento">
                            </div>
                            <div class="error-message" id="addressError"></div>
                        </div>

                        <!-- Bairro -->
                        <div class="form-group">
                            <label for="neighborhood">Bairro</label>
                            <input type="text" id="neighborhood" name="neighborhood" 
                                   placeholder="Nome do bairro">
                        </div>

                        <!-- Cidade -->
                        <div class="form-group">
                            <label for="city">Cidade</label>
                            <input type="text" id="city" name="city" 
                                   placeholder="Nome da cidade">
                        </div>

                        <!-- Estado -->
                        <div class="form-group">
                            <label for="state">Estado</label>
                            <select id="state" name="state">
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Seção 3: Contato de Emergência -->
                <div class="form-section emergency-contact-section">
                    <h2 class="section-title">
                        <i class="fas fa-phone"></i>
                        Contato de Emergência
                    </h2>
                    
                    <div class="form-grid two-columns">
                        <!-- Nome do contato -->
                        <div class="form-group">
                            <label for="emergencyContact">Nome do Contato</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user-friends"></i>
                                <input type="text" id="emergencyContact" name="emergencyContact" 
                                       placeholder="Nome completo">
                            </div>
                        </div>

                        <!-- Telefone de emergência -->
                        <div class="form-group">
                            <label for="emergencyPhone">Telefone de Emergência</label>
                            <div class="input-with-icon">
                                <i class="fas fa-phone-alt"></i>
                                <input type="tel" id="emergencyPhone" name="emergencyPhone" 
                                       placeholder="(11) 99999-9999">
                            </div>
                        </div>

                        <!-- Parentesco -->
                        <div class="form-group">
                            <label for="relationship">Parentesco/Relação</label>
                            <select id="relationship" name="relationship">
                                <option value="">Selecione...</option>
                                <option value="pai">Pai</option>
                                <option value="mae">Mãe</option>
                                <option value="filho">Filho(a)</option>
                                <option value="conjuge">Cônjuge</option>
                                <option value="irmao">Irmão(ã)</option>
                                <option value="amigo">Amigo(a)</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>

                        <!-- Email do contato -->
                        <div class="form-group">
                            <label for="emergencyEmail">E-mail do Contato</label>
                            <div class="input-with-icon">
                                <i class="fas fa-envelope"></i>
                                <input type="email" id="emergencyEmail" name="emergencyEmail" 
                                       placeholder="contato@email.com">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seção 4: Observações e Histórico -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-notes-medical"></i>
                        Observações e Histórico
                    </h2>
                    
                    <div class="form-grid single-column">
                        <!-- Motivo da consulta -->
                        <div class="form-group">
                            <label for="consultationReason">Motivo da Consulta</label>
                            <textarea id="consultationReason" name="consultationReason" 
                                      placeholder="Descreva brevemente o motivo da busca por terapia..."></textarea>
                        </div>

                        <!-- Histórico médico -->
                        <div class="form-group">
                            <label for="medicalHistory">Histórico Médico Relevante</label>
                            <textarea id="medicalHistory" name="medicalHistory" 
                                      placeholder="Medicamentos em uso, condições médicas, alergias, etc..."></textarea>
                        </div>

                        <!-- Observações gerais -->
                        <div class="form-group">
                            <label for="notes">Observações Gerais</label>
                            <textarea id="notes" name="notes" 
                                      placeholder="Qualquer informação adicional relevante..."></textarea>
                        </div>

                        <!-- Preferências de atendimento -->
                        <div class="form-group">
                            <label for="preferences">Preferências de Atendimento</label>
                            <select id="preferences" name="preferences">
                                <option value="">Selecione...</option>
                                <option value="presencial">Presencial</option>
                                <option value="online">Online</option>
                                <option value="hibrido">Híbrido (Presencial + Online)</option>
                            </select>
                        </div>

                        <!-- Profissão e Atividade -->
                        <div class="form-group">
                            <label for="profession">Profissão</label>
                            <input type="text" id="profession" name="profession" 
                                   placeholder="Sua profissão">
                        </div>

                        <div class="form-group">
                            <label for="company">Empresa</label>
                            <input type="text" id="company" name="company" 
                                   placeholder="Nome da empresa">
                        </div>

                        <div class="form-group">
                            <label for="activity">Atividade</label>
                            <input type="text" id="activity" name="activity" 
                                   placeholder="Que atividade exerce">
                        </div>

                        <div class="form-group">
                            <label for="position">Cargo</label>
                            <input type="text" id="position" name="position" 
                                   placeholder="Cargo que ocupa">
                        </div>

                        <div class="form-group">
                            <label for="religion">Religião</label>
                            <input type="text" id="religion" name="religion" 
                                   placeholder="Religião (opcional)">
                        </div>

                        <div class="form-group">
                            <label for="education">Escolaridade</label>
                            <select id="education" name="education">
                                <option value="">Selecione...</option>
                                <option value="fundamental-incompleto">Ensino Fundamental Incompleto</option>
                                <option value="fundamental-completo">Ensino Fundamental Completo</option>
                                <option value="medio-incompleto">Ensino Médio Incompleto</option>
                                <option value="medio-completo">Ensino Médio Completo</option>
                                <option value="superior-incompleto">Ensino Superior Incompleto</option>
                                <option value="superior-completo">Ensino Superior Completo</option>
                                <option value="pos-graduacao">Pós-graduação</option>
                                <option value="mestrado">Mestrado</option>
                                <option value="doutorado">Doutorado</option>
                            </select>
                        </div>

                        <!-- Queixa Principal -->
                        <div class="form-group full-width">
                            <label for="mainComplaint">Queixa Principal - O que te trouxe até aqui?</label>
                            <textarea id="mainComplaint" name="mainComplaint" 
                                      placeholder="Descreva detalhadamente o motivo que te trouxe à terapia..." 
                                      style="min-height: 150px;"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Seção 5: Anamnese - Fase 01 - Vida Pessoal -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-heart"></i>
                        Fase 01 - Vida Pessoal
                    </h2>
                    
                    <div class="form-grid single-column">
                        <!-- Estado Civil -->
                        <div class="form-group">
                            <label for="maritalStatus">Estado Civil</label>
                            <select id="maritalStatus" name="maritalStatus">
                                <option value="">Selecione...</option>
                                <option value="solteiro">Solteiro(a)</option>
                                <option value="casado">Casado(a)</option>
                                <option value="divorciado">Divorciado(a)</option>
                                <option value="viuvo">Viúvo(a)</option>
                                <option value="uniao-estavel">União Estável</option>
                            </select>
                        </div>

                        <!-- Se divorciado -->
                        <div class="form-group" id="divorceReasonGroup" style="display: none;">
                            <label for="divorceReason">Se é divorciada(o), por qual motivo e como se sente?</label>
                            <textarea id="divorceReason" name="divorceReason" 
                                      placeholder="Descreva o motivo do divórcio e como se sente..."></textarea>
                        </div>

                        <!-- Número de filhos -->
                        <div class="form-group">
                            <label for="numberOfChildren">Número de filhos</label>
                            <input type="number" id="numberOfChildren" name="numberOfChildren" 
                                   min="0" placeholder="0">
                        </div>

                        <!-- Relacionamento com filhos -->
                        <div class="form-group" id="childrenRelationshipGroup" style="display: none;">
                            <label for="childrenRelationship">Como é o seu relacionamento com seus filhos?</label>
                            <textarea id="childrenRelationship" name="childrenRelationship" 
                                      placeholder="Descreva como é seu relacionamento com seus filhos..."></textarea>
                        </div>

                        <!-- Relacionamento com parceiro -->
                        <div class="form-group">
                            <label for="partnerRelationship">Como você se sente em seu relacionamento com sua parceira(o)?</label>
                            <textarea id="partnerRelationship" name="partnerRelationship" 
                                      placeholder="Descreva como se sente no relacionamento..."></textarea>
                        </div>

                        <!-- Contexto familiar -->
                        <div class="form-group">
                            <label for="familyContext">Como você se sente em sua casa, dentro do contexto familiar?</label>
                            <textarea id="familyContext" name="familyContext" 
                                      placeholder="Descreva como se sente no ambiente familiar..."></textarea>
                        </div>

                        <!-- Trabalho -->
                        <div class="form-group">
                            <label for="workFeeling">Como você se sente no seu trabalho?</label>
                            <textarea id="workFeeling" name="workFeeling" 
                                      placeholder="Descreva como se sente no trabalho..."></textarea>
                        </div>

                        <!-- Pertencimento -->
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label>Você se sente pertencendo ao Contexto Familiar?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="familyBelonging" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="familyBelonging" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="familyBelongingWhy" placeholder="Por quê?" style="margin-top: 1rem;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Você se sente pertencendo ao Contexto Social?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="socialBelonging" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="socialBelonging" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="socialBelongingWhy" placeholder="Por quê?" style="margin-top: 1rem;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Você se sente pertencendo ao Contexto Religioso?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="religiousBelonging" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="religiousBelonging" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="religiousBelongingWhy" placeholder="Por quê?" style="margin-top: 1rem;"></textarea>
                            </div>
                        </div>

                        <!-- Frustrações -->
                        <div class="form-group full-width">
                            <label>Você sente frustração em relação a:</label>
                            <div class="form-grid two-columns">
                                <div>
                                    <label style="font-weight: normal;">Pais?</label>
                                    <textarea name="frustrationParents" placeholder="Descreva..."></textarea>
                                </div>
                                <div>
                                    <label style="font-weight: normal;">Irmãos?</label>
                                    <textarea name="frustrationSiblings" placeholder="Descreva..."></textarea>
                                </div>
                                <div>
                                    <label style="font-weight: normal;">Filhos?</label>
                                    <textarea name="frustrationChildren" placeholder="Descreva..."></textarea>
                                </div>
                                <div>
                                    <label style="font-weight: normal;">Profissão?</label>
                                    <textarea name="frustrationProfession" placeholder="Descreva..."></textarea>
                                </div>
                                <div>
                                    <label style="font-weight: normal;">Colégio?</label>
                                    <textarea name="frustrationSchool" placeholder="Descreva..."></textarea>
                                </div>
                                <div>
                                    <label style="font-weight: normal;">Cônjuge?</label>
                                    <textarea name="frustrationSpouse" placeholder="Descreva..."></textarea>
                                </div>
                                <div>
                                    <label style="font-weight: normal;">Identidade Sexual?</label>
                                    <textarea name="frustrationSexualIdentity" placeholder="Descreva..."></textarea>
                                </div>
                                <div>
                                    <label style="font-weight: normal;">Vida Sexual?</label>
                                    <textarea name="frustrationSexualLife" placeholder="Descreva..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Sexualidade -->
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="sexualityAge">Iniciou sua sexualidade com que idade?</label>
                                <input type="number" id="sexualityAge" name="sexualityAge" min="0" max="100">
                            </div>

                            <div class="form-group">
                                <label>Como foi sua primeira vez?</label>
                                <select name="firstTimeExperience">
                                    <option value="">Selecione...</option>
                                    <option value="traumatica">Traumática</option>
                                    <option value="normal">Normal</option>
                                    <option value="boa">Boa</option>
                                    <option value="satisfatoria">Satisfatória</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="sexualProblems">Tem tido algum problema em relação ao sexo?</label>
                            <textarea id="sexualProblems" name="sexualProblems" 
                                      placeholder="Descreva problemas sexuais, se houver..."></textarea>
                        </div>

                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label>Atualmente sempre se realiza nas relações sexuais?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="sexualSatisfaction" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="sexualSatisfaction" value="nao">
                                        Não
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>O sexo para você é algo:</label>
                                <select name="sexImportance">
                                    <option value="">Selecione...</option>
                                    <option value="importante">Importante</option>
                                    <option value="sem-importancia">Sem importância</option>
                                    <option value="muito-importante">Muito importante</option>
                                </select>
                            </div>
                        </div>

                        <!-- Questões de saúde e comportamento -->
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label>Algum trauma?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasTrauma" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasTrauma" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="traumaDetails" placeholder="Qual?" style="margin-top: 1rem;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Alguma fobia?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasPhobia" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasPhobia" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="phobiaDetails" placeholder="Qual?" style="margin-top: 1rem;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Tem medo de alguma coisa?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasFear" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasFear" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="fearDetails" placeholder="De quê?" style="margin-top: 1rem;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Usa drogas?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="usesDrugs" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="usesDrugs" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="drugsDetails" placeholder="Quais?" style="margin-top: 1rem;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Dores de cabeça?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasHeadaches" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasHeadaches" value="nao">
                                        Não
                                    </label>
                                </div>
                                <input type="text" name="headacheFrequency" placeholder="Com que frequência?" style="margin-top: 1rem;">
                            </div>

                            <div class="form-group">
                                <label>Insônia?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasInsomnia" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasInsomnia" value="nao">
                                        Não
                                    </label>
                                </div>
                                <input type="text" name="insomniaFrequency" placeholder="Com que frequência?" style="margin-top: 1rem;">
                            </div>

                            <div class="form-group">
                                <label>Tem ideias suicidas?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasSuicidalThoughts" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="hasSuicidalThoughts" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="suicidalThoughtsDetails" placeholder="Quais?" style="margin-top: 1rem;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Usa bebidas alcoólicas?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="drinksAlcohol" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="drinksAlcohol" value="nao">
                                        Não
                                    </label>
                                </div>
                                <input type="text" name="alcoholFrequency" placeholder="Com que frequência?" style="margin-top: 1rem;">
                            </div>

                            <div class="form-group">
                                <label>É fumante?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="smokes" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="smokes" value="nao">
                                        Não
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Está grávida?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="isPregnant" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="isPregnant" value="nao">
                                        Não
                                    </label>
                                </div>
                                <input type="number" name="pregnancyWeeks" placeholder="Quantas semanas?" style="margin-top: 1rem;">
                            </div>

                            <div class="form-group">
                                <label>Qual o seu nível de stress?</label>
                                <select name="stressLevel">
                                    <option value="">Selecione...</option>
                                    <option value="alto">Alto</option>
                                    <option value="medio">Médio</option>
                                    <option value="baixo">Baixo</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Atualmente está tomando alguma medicação?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="takesMedication" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="takesMedication" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="medicationDetails" placeholder="Qual?" style="margin-top: 1rem;"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Já consultou algum tipo de psiquiatra ou psicólogo?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="consultedPsych" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="consultedPsych" value="nao">
                                        Não
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Se sim, foi diagnosticada(o)?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="wasDiagnosed" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="wasDiagnosed" value="nao">
                                        Não
                                    </label>
                                </div>
                                <textarea name="diagnosisDetails" placeholder="Qual diagnóstico?" style="margin-top: 1rem;"></textarea>
                            </div>
                        </div>

                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="numberOfFriends">Qual a quantidade de amigos que você tem?</label>
                                <input type="text" id="numberOfFriends" name="numberOfFriends" 
                                       placeholder="Quantidade aproximada">
                            </div>

                            <div class="form-group">
                                <label for="favoriteHobby">Qual seu passatempo preferido?</label>
                                <input type="text" id="favoriteHobby" name="favoriteHobby" 
                                       placeholder="Descreva seu passatempo favorito">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="peoplesBelief">Qual a principal crença que as pessoas possuem em relação a você que mais se repete?</label>
                            <textarea id="peoplesBelief" name="peoplesBelief" 
                                      placeholder="Descreva o que as pessoas costumam pensar sobre você..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Você se considera feliz?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="considersHappy" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="considersHappy" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="happinessReason" placeholder="Por quê?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="wouldChange">Se você pudesse mudar alguma coisa em você, no seu modo de ser, ou agir, ou no seu comportamento atual, o que mudaria?</label>
                            <textarea id="wouldChange" name="wouldChange" 
                                      placeholder="Descreva o que mudaria em si mesmo..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="lifeDefinition">Defina o que é a vida em apenas uma frase</label>
                            <textarea id="lifeDefinition" name="lifeDefinition" 
                                      placeholder="Para você, o que é a vida?"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Seção 6: Anamnese - Fase 02 - Mental -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-brain"></i>
                        Fase 02 - Mental
                    </h2>
                    
                    <div class="form-grid single-column">
                        <!-- Tipos de pensamentos -->
                        <div class="form-group">
                            <label>Quais são os tipos de pensamentos que você costuma alimentar em relação a si mesma(o), de uma maneira geral?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="generalThoughts" value="positivos">
                                    Positivos
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="generalThoughts" value="negativos">
                                    Negativos
                                </label>
                            </div>
                            <textarea name="generalThoughtsDetails" placeholder="Quais exatamente?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Em relação a sua aparência física?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="physicalAppearanceThoughts" value="positivos">
                                    Positivos
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="physicalAppearanceThoughts" value="negativos">
                                    Negativos
                                </label>
                            </div>
                            <textarea name="physicalAppearanceThoughtsDetails" placeholder="Quais exatamente?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Em relação a sua competência profissional?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="professionalCompetenceThoughts" value="positivos">
                                    Positivos
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="professionalCompetenceThoughts" value="negativos">
                                    Negativos
                                </label>
                            </div>
                            <textarea name="professionalCompetenceThoughtsDetails" placeholder="Quais exatamente?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Em relação a sua vida emocional?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="emotionalLifeThoughts" value="positivos">
                                    Positivos
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="emotionalLifeThoughts" value="negativos">
                                    Negativos
                                </label>
                            </div>
                            <textarea name="emotionalLifeThoughtsDetails" placeholder="Quais exatamente?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Em relação a sua vida sexual?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="sexualLifeThoughts" value="positivos">
                                    Positivos
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="sexualLifeThoughts" value="negativos">
                                    Negativos
                                </label>
                            </div>
                            <textarea name="sexualLifeThoughtsDetails" placeholder="Quais exatamente?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Em relação ao seu passado?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="pastThoughts" value="positivos">
                                    Positivos
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="pastThoughts" value="negativos">
                                    Negativos
                                </label>
                            </div>
                            <textarea name="pastThoughtsDetails" placeholder="Quais exatamente?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Em relação ao seu futuro?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="futureThoughts" value="positivos">
                                    Positivos
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="futureThoughts" value="negativos">
                                    Negativos
                                </label>
                            </div>
                            <textarea name="futureThoughtsDetails" placeholder="Quais exatamente?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="selfVision">Qual sua visão sobre você?</label>
                            <textarea id="selfVision" name="selfVision" 
                                      placeholder="Como você se vê? Descreva sua autopercepção..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Seção 7: Anamnese - Fase 03 - Infância -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-child"></i>
                        Fase 03 - Infância
                    </h2>
                    
                    <div class="form-grid single-column">
                        <div class="form-group">
                            <label>Você foi criado pelos pais?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="raisedByParents" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="raisedByParents" value="nao">
                                    Não
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Como é sua relação com seus pais?</label>
                            <div style="margin: 1rem 0;">
                                <label style="font-weight: normal; display: block; margin-bottom: 0.5rem;">Pai:</label>
                                <textarea name="fatherRelationship" placeholder="Descreva sua relação com seu pai..."></textarea>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="font-weight: normal; display: block; margin-bottom: 0.5rem;">Mãe:</label>
                                <textarea name="motherRelationship" placeholder="Descreva sua relação com sua mãe..."></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Seus pais foram agressivos com você?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsAggressive" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsAggressive" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="aggressionDetails" placeholder="Descreva como era a agressividade..." style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Qual deles era o mais bravo?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="angrierParent" value="pai">
                                    O Pai
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="angrierParent" value="mae">
                                    A Mãe
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Usavam bebidas ou drogas?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsSubstanceUse" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsSubstanceUse" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="parentsSubstanceDetails" placeholder="Descreva o uso de substâncias..." style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Como você descreveria o relacionamento entre seus pais?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsRelationship" value="excelente">
                                    Excelente
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsRelationship" value="muito-bom">
                                    Muito Bom
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsRelationship" value="bom">
                                    Bom
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsRelationship" value="regular">
                                    Regular
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="parentsRelationship" value="pessimo">
                                    Péssimo
                                </label>
                            </div>
                            <textarea name="parentsRelationshipWhy" placeholder="Por quê?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="relationshipAspects">Quais os aspectos deste relacionamento que se assemelham, ou se repetem em sua vida hoje?</label>
                            <textarea id="relationshipAspects" name="relationshipAspects" 
                                      placeholder="Descreva aspectos que se repetem..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="avoidAspects">Quais as características deste relacionamento, que você se mantém determinada(o) a não repetir?</label>
                            <textarea id="avoidAspects" name="avoidAspects" 
                                      placeholder="O que você evita repetir?"></textarea>
                            <textarea name="avoidAspectsWhy" placeholder="Por quê?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="relationshipBelief">Quanto ao relacionamento de seus pais responda: Qual a crença que você adquiriu em relação a relacionamentos?</label>
                            <textarea id="relationshipBelief" name="relationshipBelief" 
                                      placeholder="Que crença você formou sobre relacionamentos?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Na infância, era obrigada(o) a fazer alguma coisa que lhe desagradava?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="forcedToDoThings" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="forcedToDoThings" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="forcedThingsDetails" placeholder="O que era obrigado(a) a fazer?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Lembra-se, de alguma coisa que o magoou muito na Infância?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="childhoodHurt" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="childhoodHurt" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="childhoodHurtDetails" placeholder="O que te magoou?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Teve perdas familiares ou de amigos na Infância?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="childhoodLosses" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="childhoodLosses" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="childhoodLossesDetails" placeholder="Quais perdas?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="pastSadness">O que te faz sentir tristeza ao relembrar do passado?</label>
                            <textarea id="pastSadness" name="pastSadness" 
                                      placeholder="O que traz tristeza ao lembrar?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="childhoodFears">Quando criança tinha medo de que?</label>
                            <textarea id="childhoodFears" name="childhoodFears" 
                                      placeholder="Quais eram seus medos na infância?"></textarea>
                        </div>

                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label>Dormia com a luz acesa ou apagada?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="sleepWithLight" value="acesa">
                                        Acesa
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="sleepWithLight" value="apagada">
                                        Apagada
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Como foi sua adolescência?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="adolescence" value="ruim">
                                        Ruim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="adolescence" value="boa">
                                        Boa
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="adolescence" value="otima">
                                        Ótima
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Teve fase de rebeldia na adolescência?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="rebelliousPhase" value="sim">
                                        Sim
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="rebelliousPhase" value="nao">
                                        Não
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Com qual de seus pais você tinha mais dificuldade de relacionamento?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="difficultParent" value="pai">
                                        Pai
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="difficultParent" value="mae">
                                        Mãe
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                        <input type="radio" name="difficultParent" value="ambos">
                                        Ambos
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="familyPhilosophySuccess">Qual a Filosofia de sua família em relação ao sucesso profissional?</label>
                            <textarea id="familyPhilosophySuccess" name="familyPhilosophySuccess" 
                                      placeholder="Como sua família via o sucesso profissional?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="familyPhilosophyMoney">Ao dinheiro?</label>
                            <textarea id="familyPhilosophyMoney" name="familyPhilosophyMoney" 
                                      placeholder="Como sua família via o dinheiro?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="familyPhilosophyLove">Ao amor?</label>
                            <textarea id="familyPhilosophyLove" name="familyPhilosophyLove" 
                                      placeholder="Como sua família via o amor?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="familyPhilosophySex">Ao sexo?</label>
                            <textarea id="familyPhilosophySex" name="familyPhilosophySex" 
                                      placeholder="Como sua família via o sexo?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="goodChild">O que era para você, ser uma boa(bom) menina(o)? Descreva.</label>
                            <textarea id="goodChild" name="goodChild" 
                                      placeholder="Como você deveria ser para ser considerado(a) bom(boa)?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="toBeLoved">Como você deveria agir, ou ser para ser amada(o)?</label>
                            <textarea id="toBeLoved" name="toBeLoved" 
                                      placeholder="O que você precisava fazer para receber amor?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Possui irmãos?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="hasSiblings" value="nao">
                                    Não
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="hasSiblings" value="sim">
                                    Sim
                                </label>
                            </div>
                            <input type="number" name="siblingsCount" placeholder="Quantos?" style="margin-top: 1rem;" min="0">
                            <textarea name="siblingsRelationship" placeholder="Como é sua relação com eles?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Você foi uma criança introvertida ou extrovertida?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="childPersonality" value="introvertida">
                                    Introvertida
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="childPersonality" value="extrovertida">
                                    Extrovertida
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="schoolRelationships">Havia dificuldades de relacionamentos com os colegas do colégio? Se sim, cite-os.</label>
                            <textarea id="schoolRelationships" name="schoolRelationships" 
                                      placeholder="Descreva as dificuldades de relacionamento na escola..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="childhoodBiggestFears">Quais eram seus maiores medos na infância?</label>
                            <textarea id="childhoodBiggestFears" name="childhoodBiggestFears" 
                                      placeholder="Descreva seus maiores medos quando criança..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="childhoodSignificantEvent">Relate algum fato marcante em sua infância</label>
                            <textarea id="childhoodSignificantEvent" name="childhoodSignificantEvent" 
                                      placeholder="Descreva um evento marcante da sua infância..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Seção 8: Anamnese - Fase 04 - Emocional -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-heart-pulse"></i>
                        Fase 04 - Emocional
                    </h2>
                    
                    <div class="form-grid single-column">
                        <div class="form-group">
                            <label for="currentFears">Quais são seus maiores medos hoje?</label>
                            <textarea id="currentFears" name="currentFears" 
                                      placeholder="Descreva seus medos atuais..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="selfThought">O que você pensa a seu respeito?</label>
                            <textarea id="selfThought" name="selfThought" 
                                      placeholder="Como você se vê e o que pensa sobre si mesmo(a)?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="firstRelationship">Como foi o seu primeiro relacionamento amoroso?</label>
                            <textarea id="firstRelationship" name="firstRelationship" 
                                      placeholder="Descreva seu primeiro relacionamento amoroso..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Se você avaliasse sua atuação na vida, qual papel que mais caberia a você hoje?</label>
                            <div style="display: flex; gap: 1rem; margin: 0.5rem 0;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="lifeRole" value="vitima">
                                    Vítima
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="lifeRole" value="responsavel">
                                    Responsável
                                </label>
                            </div>
                            <textarea name="secondaryGain" placeholder="Qual o ganho secundário?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="victimSituations">Em quais situações você desempenha o papel de vítima?</label>
                            <textarea id="victimSituations" name="victimSituations" 
                                      placeholder="Descreva situações onde se sente vítima..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="responsibleSituations">Em quais situações você desempenha o papel de responsável?</label>
                            <textarea id="responsibleSituations" name="responsibleSituations" 
                                      placeholder="Descreva situações onde se sente responsável..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Se considera vitoriosa(o) ou derrotada(o)?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="considersVictorious" value="vitoriosa">
                                    Vitoriosa(o)
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="considersVictorious" value="derrotada">
                                    Derrotada(o)
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Nos relacionamentos e na vida, você prefere ser:</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="relationshipStyle" value="dominante">
                                    Dominante
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="relationshipStyle" value="submisso">
                                    Submisso
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="whoToPunish">Quem deve ser punido por problemas que ocorrem com você? OU Quem é o culpado por seus problemas pessoais?</label>
                            <textarea id="whoToPunish" name="whoToPunish" 
                                      placeholder="A quem você atribui a culpa pelos seus problemas?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Sente raiva ou rancor de alguém?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="feelsAnger" value="nao">
                                    Não
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="feelsAnger" value="sim">
                                    Sim
                                </label>
                            </div>
                            <input type="text" name="angerTarget" placeholder="Quem?" style="margin-top: 1rem;">
                        </div>

                        <div class="form-group">
                            <label>Sente-se de alguma forma pressionada(o) na atualidade?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="feelsPressured" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="feelsPressured" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="pressureDetails" placeholder="De que maneira?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Você se acha uma pessoa controladora?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="isControlling" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="isControlling" value="nao">
                                    Não
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Sente-se de alguma forma inferior aos outros?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="feelsInferior" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="feelsInferior" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="inferiorityReason" placeholder="Por quê?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Duvida de sua própria capacidade?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="doubtsCapacity" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="doubtsCapacity" value="nao">
                                    Não
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Você é audaciosa(o), corre atrás de suas metas, ou é auto protetor(a), preferindo se poupar dos eventuais riscos?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="personality" value="audaciosa">
                                    Audaciosa(o)
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="personality" value="auto-protetor">
                                    Auto protetor(a)
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Existe algo que a(o) faz sentir-se culpada(o)?</label>
                            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="feelsGuilty" value="sim">
                                    Sim
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                                    <input type="radio" name="feelsGuilty" value="nao">
                                    Não
                                </label>
                            </div>
                            <textarea name="guiltReason" placeholder="O que exatamente?" style="margin-top: 1rem;"></textarea>
                        </div>

                        <!-- Escala de Sentimentos -->
                        <div class="form-group full-width">
                            <label style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1.5rem; display: block;">
                                Quais os sentimentos mais comuns em você hoje?
                                <span style="font-size: 0.9rem; font-weight: normal; color: #666; display: block; margin-top: 0.5rem;">
                                    Para cada sentimento, indique a intensidade que melhor te representa:
                                </span>
                            </label>
                            
                            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px; margin-top: 1rem;">
                                <div class="feelings-scale">
                                    <!-- Cabeçalho da escala -->
                                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem; font-weight: 600; padding-bottom: 0.5rem; border-bottom: 2px solid #dee2e6;">
                                        <div>Sentimento</div>
                                        <div style="text-align: center;">Muita Intensidade</div>
                                        <div style="text-align: center;">Média Intensidade</div>
                                        <div style="text-align: center;">Pouca Intensidade</div>
                                    </div>

                                    <!-- Lista de sentimentos -->
                                    <div id="feelingsScaleContainer">
                                        <!-- Será preenchido via JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ações do formulário -->
                <div class="form-actions">
                    <a href="pacientes.html" class="btn-cancel">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </a>
                    <button type="submit" class="btn-save" id="submitBtn">
                        <i class="fas fa-save"></i>
                        Salvar Paciente
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Salvando paciente...</h3>
            <p>Por favor, aguarde.</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <p>&copy; 2025 mentePro. Todos os direitos reservados.</p>
            <div class="footer-links">
                <a href="#">Política de Privacidade</a>
                <a href="#">Termos de Uso</a>
                <a href="#">Suporte</a>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/paciente.js"></script>
    <script>
        // Variáveis globais
        let isEditMode = false;
        let currentPatientId = null;
        let formValidator = null;

        // Verificar autenticação e inicializar
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se usuário está logado
            const currentUser = sessionStorage.getItem('mentePro_currentUser');
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }

            const user = JSON.parse(currentUser);
            document.getElementById('userName').textContent = user.displayName || user.email;

            // Configurar logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (window.authManager) {
                    window.authManager.handleLogout();
                } else {
                    sessionStorage.removeItem('mentePro_currentUser');
                    localStorage.removeItem('mentePro_session');
                    window.location.href = 'index.html';
                }
            });

            // Verificar se é modo de edição
            checkEditMode();

            // Inicializar formulário
            initializeForm();

            // Gerar escala de sentimentos
            generateFeelingsScale();

            // Configurar listeners dinâmicos
            setupDynamicListeners();
        });

        function checkEditMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const patientId = urlParams.get('edit');
            
            if (patientId) {
                isEditMode = true;
                currentPatientId = patientId;
                
                // Atualizar título
                document.getElementById('formTitle').innerHTML = `
                    <i class="fas fa-user-edit"></i>
                    Editar Paciente
                `;
                document.getElementById('formSubtitle').textContent = 
                    'Atualize as informações do paciente no formulário abaixo';
                    
                document.getElementById('submitBtn').innerHTML = `
                    <i class="fas fa-save"></i>
                    Atualizar Paciente
                `;

                // Carregar dados do paciente
                loadPatientData(patientId);
            }
        }

        function loadPatientData(patientId) {
            // Aguardar o PatientManager estar disponível
            const checkPatientManager = setInterval(() => {
                if (window.patientManager) {
                    clearInterval(checkPatientManager);
                    
                    const patient = window.patientManager.patients.find(p => p.id === patientId);
                    if (patient) {
                        populateForm(patient);
                    } else {
                        alert('Paciente não encontrado!');
                        window.location.href = 'pacientes.html';
                    }
                }
            }, 100);
        }

        function generateFeelingsScale() {
            const feelings = [
                'Raiva', 'Medo de algo concreto', 'Medos vagos', 'Culpa', 'Revolta', 'Medo de perder o controle',
                'Tristeza', 'Mágoa', 'Orgulho', 'Ódio', 'Egoísmo', 'Ansiedade', 'Intolerância', 'Submissão',
                'Indecisão', 'Desespero', 'Desânimo', 'Covardia', 'Egocentrismo', 'Ciúme', 'Frustração',
                'Nostalgia', 'Cansaço', 'Impaciência', 'Angústia', 'Timidez', 'Apatia', 'Ressentimento',
                'Solidão', 'Autoritarismo'
            ];

            const container = document.getElementById('feelingsScaleContainer');
            
            feelings.forEach((feeling, index) => {
                const feelingName = feeling.toLowerCase().replace(/[^a-z0-9]/g, '');
                
                const feelingRow = document.createElement('div');
                feelingRow.style.cssText = `
                    display: grid; 
                    grid-template-columns: 2fr 1fr 1fr 1fr; 
                    gap: 1rem; 
                    padding: 0.75rem; 
                    border-bottom: 1px solid #e9ecef;
                    align-items: center;
                `;
                
                feelingRow.innerHTML = `
                    <div style="font-weight: 500;">${feeling}</div>
                    <div style="text-align: center;">
                        <input type="radio" name="feeling_${feelingName}" value="muita" style="transform: scale(1.2);">
                    </div>
                    <div style="text-align: center;">
                        <input type="radio" name="feeling_${feelingName}" value="media" style="transform: scale(1.2);">
                    </div>
                    <div style="text-align: center;">
                        <input type="radio" name="feeling_${feelingName}" value="pouca" style="transform: scale(1.2);">
                    </div>
                `;
                
                container.appendChild(feelingRow);
            });
        }

        function setupDynamicListeners() {
            // Mostrar/ocultar campo de divórcio
            const maritalStatus = document.getElementById('maritalStatus');
            const divorceGroup = document.getElementById('divorceReasonGroup');
            
            if (maritalStatus && divorceGroup) {
                maritalStatus.addEventListener('change', function() {
                    divorceGroup.style.display = this.value === 'divorciado' ? 'block' : 'none';
                });
            }

            // Mostrar/ocultar relacionamento com filhos
            const numberOfChildren = document.getElementById('numberOfChildren');
            const childrenRelationshipGroup = document.getElementById('childrenRelationshipGroup');
            
            if (numberOfChildren && childrenRelationshipGroup) {
                numberOfChildren.addEventListener('input', function() {
                    const hasChildren = parseInt(this.value) > 0;
                    childrenRelationshipGroup.style.display = hasChildren ? 'block' : 'none';
                });
            }
        }

        function populateForm(patient) {
            // Preencher campos básicos
            document.getElementById('name').value = patient.name || '';
            document.getElementById('email').value = patient.email || '';
            document.getElementById('phone').value = patient.phone || '';
            document.getElementById('birthDate').value = patient.birthDate || '';
            document.getElementById('gender').value = patient.gender || '';
            document.getElementById('cpf').value = patient.cpf || '';
            
            // Endereço
            document.getElementById('address').value = patient.address || '';
            document.getElementById('cep').value = patient.cep || '';
            document.getElementById('neighborhood').value = patient.neighborhood || '';
            document.getElementById('city').value = patient.city || '';
            document.getElementById('state').value = patient.state || '';
            
            // Contato de emergência
            document.getElementById('emergencyContact').value = patient.emergencyContact || '';
            document.getElementById('emergencyPhone').value = patient.emergencyPhone || '';
            document.getElementById('relationship').value = patient.relationship || '';
            document.getElementById('emergencyEmail').value = patient.emergencyEmail || '';
            
            // Observações
            document.getElementById('consultationReason').value = patient.consultationReason || '';
            document.getElementById('medicalHistory').value = patient.medicalHistory || '';
            document.getElementById('notes').value = patient.notes || '';
            document.getElementById('preferences').value = patient.preferences || '';
            
            // Dados profissionais
            document.getElementById('profession').value = patient.profession || '';
            document.getElementById('company').value = patient.company || '';
            document.getElementById('activity').value = patient.activity || '';
            document.getElementById('position').value = patient.position || '';
            document.getElementById('religion').value = patient.religion || '';
            document.getElementById('education').value = patient.education || '';
            document.getElementById('mainComplaint').value = patient.mainComplaint || '';
            
            // Anamnese - Fase 01
            document.getElementById('maritalStatus').value = patient.maritalStatus || '';
            document.getElementById('divorceReason').value = patient.divorceReason || '';
            document.getElementById('numberOfChildren').value = patient.numberOfChildren || '';
            document.getElementById('childrenRelationship').value = patient.childrenRelationship || '';
            
            // Popular todos os outros campos da anamnese...
            // (devido ao limite de espaço, vou focar nos mais importantes)
        }

        function initializeForm() {
            // Configurar validação em tempo real
            setupFormValidation();
            
            // Configurar upload de foto
            setupPhotoUpload();
            
            // Configurar máscaras de input
            setupInputMasks();
            
            // Configurar CEP lookup
            setupCepLookup();
            
            // Configurar submit do formulário
            setupFormSubmit();
        }

        function setupFormValidation() {
            const requiredFields = ['name', 'email', 'phone', 'birthDate', 'address'];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('blur', () => validateField(fieldId));
                    field.addEventListener('input', () => clearFieldError(fieldId));
                }
            });

            // Validação específica de email
            const emailField = document.getElementById('email');
            if (emailField) {
                emailField.addEventListener('blur', validateEmail);
            }
        }

        function validateField(fieldId) {
            const field = document.getElementById(fieldId);
            const errorElement = document.getElementById(fieldId + 'Error');
            const formGroup = field.closest('.form-group');
            
            let isValid = true;
            let errorMessage = '';

            switch (fieldId) {
                case 'name':
                    if (!field.value.trim() || field.value.trim().length < 2) {
                        isValid = false;
                        errorMessage = 'Nome deve ter pelo menos 2 caracteres.';
                    }
                    break;
                
                case 'email':
                    if (!field.value.trim()) {
                        isValid = false;
                        errorMessage = 'E-mail é obrigatório.';
                    } else if (!isValidEmail(field.value)) {
                        isValid = false;
                        errorMessage = 'E-mail inválido.';
                    }
                    break;
                
                case 'phone':
                    if (!field.value.trim()) {
                        isValid = false;
                        errorMessage = 'Telefone é obrigatório.';
                    } else if (field.value.replace(/\D/g, '').length < 10) {
                        isValid = false;
                        errorMessage = 'Telefone deve ter pelo menos 10 dígitos.';
                    }
                    break;
                
                case 'birthDate':
                    if (!field.value) {
                        isValid = false;
                        errorMessage = 'Data de nascimento é obrigatória.';
                    } else {
                        const birthDate = new Date(field.value);
                        const today = new Date();
                        if (birthDate > today) {
                            isValid = false;
                            errorMessage = 'Data de nascimento não pode ser no futuro.';
                        }
                    }
                    break;
                
                case 'address':
                    if (!field.value.trim()) {
                        isValid = false;
                        errorMessage = 'Endereço é obrigatório.';
                    }
                    break;
            }

            // Atualizar visual
            if (isValid) {
                formGroup.classList.remove('invalid');
                formGroup.classList.add('valid');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            } else {
                formGroup.classList.remove('valid');
                formGroup.classList.add('invalid');
                if (errorElement) {
                    errorElement.textContent = errorMessage;
                    errorElement.style.display = 'block';
                }
            }

            return isValid;
        }

        function clearFieldError(fieldId) {
            const field = document.getElementById(fieldId);
            const formGroup = field.closest('.form-group');
            formGroup.classList.remove('invalid');
        }

        function validateEmail() {
            const emailField = document.getElementById('email');
            if (emailField.value && isValidEmail(emailField.value)) {
                // Verificar se email já existe (apenas no modo de criação)
                if (!isEditMode && window.patientManager) {
                    const existingPatient = window.patientManager.patients.find(
                        p => p.email.toLowerCase() === emailField.value.toLowerCase()
                    );
                    
                    if (existingPatient) {
                        const formGroup = emailField.closest('.form-group');
                        const errorElement = document.getElementById('emailError');
                        
                        formGroup.classList.add('invalid');
                        if (errorElement) {
                            errorElement.textContent = 'Este e-mail já está cadastrado.';
                            errorElement.style.display = 'block';
                        }
                        return false;
                    }
                }
            }
            return validateField('email');
        }

        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function setupPhotoUpload() {
            const photoUpload = document.getElementById('photoUpload');
            const photoInput = document.getElementById('photoInput');
            const photoPreview = document.getElementById('photoPreview');
            const uploadButton = photoUpload.querySelector('.upload-button');

            uploadButton.addEventListener('click', () => photoInput.click());

            photoInput.addEventListener('change', handlePhotoSelect);

            // Drag and drop
            photoUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                photoUpload.classList.add('dragover');
            });

            photoUpload.addEventListener('dragleave', () => {
                photoUpload.classList.remove('dragover');
            });

            photoUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                photoUpload.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type.startsWith('image/')) {
                    handlePhotoFile(files[0]);
                }
            });
        }

        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handlePhotoFile(file);
            }
        }

        function handlePhotoFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Por favor, selecione apenas arquivos de imagem.');
                return;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB
                alert('O arquivo deve ter no máximo 5MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const photoPreview = document.getElementById('photoPreview');
                photoPreview.innerHTML = `<img src="${e.target.result}" alt="Foto do paciente">`;
            };
            reader.readAsDataURL(file);
        }

        function setupInputMasks() {
            // Máscara para telefone
            const phoneInputs = document.querySelectorAll('input[type="tel"]');
            phoneInputs.forEach(input => {
                input.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length <= 11) {
                        value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
                        value = value.replace(/^(\d{2})(\d{4})(\d{4})$/, '($1) $2-$3');
                    }
                    e.target.value = value;
                });
            });

            // Máscara para CPF
            const cpfInput = document.getElementById('cpf');
            if (cpfInput) {
                cpfInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{2})$/, '$1.$2.$3-$4');
                    e.target.value = value;
                });
            }

            // Máscara para CEP
            const cepInput = document.getElementById('cep');
            if (cepInput) {
                cepInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/^(\d{5})(\d{3})$/, '$1-$2');
                    e.target.value = value;
                });
            }
        }

        function setupCepLookup() {
            const cepInput = document.getElementById('cep');
            if (cepInput) {
                cepInput.addEventListener('blur', async () => {
                    const cep = cepInput.value.replace(/\D/g, '');
                    if (cep.length === 8) {
                        try {
                            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                            const data = await response.json();
                            
                            if (!data.erro) {
                                document.getElementById('address').value = data.logradouro || '';
                                document.getElementById('neighborhood').value = data.bairro || '';
                                document.getElementById('city').value = data.localidade || '';
                                document.getElementById('state').value = data.uf || '';
                            }
                        } catch (error) {
                            console.log('Erro ao buscar CEP:', error);
                        }
                    }
                });
            }
        }

        function setupFormSubmit() {
            const form = document.getElementById('patientForm');
            form.addEventListener('submit', handleFormSubmit);
        }

        async function handleFormSubmit(event) {
            event.preventDefault();

            // Validar formulário
            if (!validateForm()) {
                return;
            }

            // Mostrar loading
            showLoading(true);

            try {
                const formData = new FormData(event.target);
                
                // Dados básicos
                const patientData = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    birthDate: formData.get('birthDate'),
                    gender: formData.get('gender'),
                    cpf: formData.get('cpf'),
                    address: formData.get('address'),
                    cep: formData.get('cep'),
                    neighborhood: formData.get('neighborhood'),
                    city: formData.get('city'),
                    state: formData.get('state'),
                    emergencyContact: formData.get('emergencyContact'),
                    emergencyPhone: formData.get('emergencyPhone'),
                    relationship: formData.get('relationship'),
                    emergencyEmail: formData.get('emergencyEmail'),
                    consultationReason: formData.get('consultationReason'),
                    medicalHistory: formData.get('medicalHistory'),
                    notes: formData.get('notes'),
                    preferences: formData.get('preferences'),
                    
                    // Dados profissionais
                    profession: formData.get('profession'),
                    company: formData.get('company'),
                    activity: formData.get('activity'),
                    position: formData.get('position'),
                    religion: formData.get('religion'),
                    education: formData.get('education'),
                    mainComplaint: formData.get('mainComplaint'),
                    
                    // Anamnese - Fase 01
                    maritalStatus: formData.get('maritalStatus'),
                    divorceReason: formData.get('divorceReason'),
                    numberOfChildren: formData.get('numberOfChildren'),
                    childrenRelationship: formData.get('childrenRelationship'),
                    partnerRelationship: formData.get('partnerRelationship'),
                    familyContext: formData.get('familyContext'),
                    workFeeling: formData.get('workFeeling'),
                    familyBelonging: formData.get('familyBelonging'),
                    familyBelongingWhy: formData.get('familyBelongingWhy'),
                    socialBelonging: formData.get('socialBelonging'),
                    socialBelongingWhy: formData.get('socialBelongingWhy'),
                    religiousBelonging: formData.get('religiousBelonging'),
                    religiousBelongingWhy: formData.get('religiousBelongingWhy'),
                    
                    // Frustrações
                    frustrationParents: formData.get('frustrationParents'),
                    frustrationSiblings: formData.get('frustrationSiblings'),
                    frustrationChildren: formData.get('frustrationChildren'),
                    frustrationProfession: formData.get('frustrationProfession'),
                    frustrationSchool: formData.get('frustrationSchool'),
                    frustrationSpouse: formData.get('frustrationSpouse'),
                    frustrationSexualIdentity: formData.get('frustrationSexualIdentity'),
                    frustrationSexualLife: formData.get('frustrationSexualLife'),
                    
                    // Sexualidade e comportamentos
                    sexualityAge: formData.get('sexualityAge'),
                    firstTimeExperience: formData.get('firstTimeExperience'),
                    sexualProblems: formData.get('sexualProblems'),
                    sexualSatisfaction: formData.get('sexualSatisfaction'),
                    sexImportance: formData.get('sexImportance'),
                    
                    // Questões de saúde
                    hasTrauma: formData.get('hasTrauma'),
                    traumaDetails: formData.get('traumaDetails'),
                    hasPhobia: formData.get('hasPhobia'),
                    phobiaDetails: formData.get('phobiaDetails'),
                    hasFear: formData.get('hasFear'),
                    fearDetails: formData.get('fearDetails'),
                    usesDrugs: formData.get('usesDrugs'),
                    drugsDetails: formData.get('drugsDetails'),
                    hasHeadaches: formData.get('hasHeadaches'),
                    headacheFrequency: formData.get('headacheFrequency'),
                    hasInsomnia: formData.get('hasInsomnia'),
                    insomniaFrequency: formData.get('insomniaFrequency'),
                    hasSuicidalThoughts: formData.get('hasSuicidalThoughts'),
                    suicidalThoughtsDetails: formData.get('suicidalThoughtsDetails'),
                    drinksAlcohol: formData.get('drinksAlcohol'),
                    alcoholFrequency: formData.get('alcoholFrequency'),
                    smokes: formData.get('smokes'),
                    isPregnant: formData.get('isPregnant'),
                    pregnancyWeeks: formData.get('pregnancyWeeks'),
                    stressLevel: formData.get('stressLevel'),
                    takesMedication: formData.get('takesMedication'),
                    medicationDetails: formData.get('medicationDetails'),
                    consultedPsych: formData.get('consultedPsych'),
                    wasDiagnosed: formData.get('wasDiagnosed'),
                    diagnosisDetails: formData.get('diagnosisDetails'),
                    
                    // Outros campos pessoais
                    numberOfFriends: formData.get('numberOfFriends'),
                    favoriteHobby: formData.get('favoriteHobby'),
                    peoplesBelief: formData.get('peoplesBelief'),
                    considersHappy: formData.get('considersHappy'),
                    happinessReason: formData.get('happinessReason'),
                    wouldChange: formData.get('wouldChange'),
                    lifeDefinition: formData.get('lifeDefinition'),
                    
                    // Fase 02 - Mental
                    generalThoughts: formData.get('generalThoughts'),
                    generalThoughtsDetails: formData.get('generalThoughtsDetails'),
                    physicalAppearanceThoughts: formData.get('physicalAppearanceThoughts'),
                    physicalAppearanceThoughtsDetails: formData.get('physicalAppearanceThoughtsDetails'),
                    professionalCompetenceThoughts: formData.get('professionalCompetenceThoughts'),
                    professionalCompetenceThoughtsDetails: formData.get('professionalCompetenceThoughtsDetails'),
                    emotionalLifeThoughts: formData.get('emotionalLifeThoughts'),
                    emotionalLifeThoughtsDetails: formData.get('emotionalLifeThoughtsDetails'),
                    sexualLifeThoughts: formData.get('sexualLifeThoughts'),
                    sexualLifeThoughtsDetails: formData.get('sexualLifeThoughtsDetails'),
                    pastThoughts: formData.get('pastThoughts'),
                    pastThoughtsDetails: formData.get('pastThoughtsDetails'),
                    futureThoughts: formData.get('futureThoughts'),
                    futureThoughtsDetails: formData.get('futureThoughtsDetails'),
                    selfVision: formData.get('selfVision'),
                    
                    // Fase 03 - Infância
                    raisedByParents: formData.get('raisedByParents'),
                    fatherRelationship: formData.get('fatherRelationship'),
                    motherRelationship: formData.get('motherRelationship'),
                    parentsAggressive: formData.get('parentsAggressive'),
                    aggressionDetails: formData.get('aggressionDetails'),
                    angrierParent: formData.get('angrierParent'),
                    parentsSubstanceUse: formData.get('parentsSubstanceUse'),
                    parentsSubstanceDetails: formData.get('parentsSubstanceDetails'),
                    parentsRelationship: formData.get('parentsRelationship'),
                    parentsRelationshipWhy: formData.get('parentsRelationshipWhy'),
                    relationshipAspects: formData.get('relationshipAspects'),
                    avoidAspects: formData.get('avoidAspects'),
                    avoidAspectsWhy: formData.get('avoidAspectsWhy'),
                    relationshipBelief: formData.get('relationshipBelief'),
                    forcedToDoThings: formData.get('forcedToDoThings'),
                    forcedThingsDetails: formData.get('forcedThingsDetails'),
                    childhoodHurt: formData.get('childhoodHurt'),
                    childhoodHurtDetails: formData.get('childhoodHurtDetails'),
                    childhoodLosses: formData.get('childhoodLosses'),
                    childhoodLossesDetails: formData.get('childhoodLossesDetails'),
                    pastSadness: formData.get('pastSadness'),
                    childhoodFears: formData.get('childhoodFears'),
                    sleepWithLight: formData.get('sleepWithLight'),
                    adolescence: formData.get('adolescence'),
                    rebelliousPhase: formData.get('rebelliousPhase'),
                    difficultParent: formData.get('difficultParent'),
                    familyPhilosophySuccess: formData.get('familyPhilosophySuccess'),
                    familyPhilosophyMoney: formData.get('familyPhilosophyMoney'),
                    familyPhilosophyLove: formData.get('familyPhilosophyLove'),
                    familyPhilosophySex: formData.get('familyPhilosophySex'),
                    goodChild: formData.get('goodChild'),
                    toBeLoved: formData.get('toBeLoved'),
                    hasSiblings: formData.get('hasSiblings'),
                    siblingsCount: formData.get('siblingsCount'),
                    siblingsRelationship: formData.get('siblingsRelationship'),
                    childPersonality: formData.get('childPersonality'),
                    schoolRelationships: formData.get('schoolRelationships'),
                    childhoodBiggestFears: formData.get('childhoodBiggestFears'),
                    childhoodSignificantEvent: formData.get('childhoodSignificantEvent'),
                    
                    // Fase 04 - Emocional
                    currentFears: formData.get('currentFears'),
                    selfThought: formData.get('selfThought'),
                    firstRelationship: formData.get('firstRelationship'),
                    lifeRole: formData.get('lifeRole'),
                    secondaryGain: formData.get('secondaryGain'),
                    victimSituations: formData.get('victimSituations'),
                    responsibleSituations: formData.get('responsibleSituations'),
                    considersVictorious: formData.get('considersVictorious'),
                    relationshipStyle: formData.get('relationshipStyle'),
                    whoToPunish: formData.get('whoToPunish'),
                    feelsAnger: formData.get('feelsAnger'),
                    angerTarget: formData.get('angerTarget'),
                    feelsPressured: formData.get('feelsPressured'),
                    pressureDetails: formData.get('pressureDetails'),
                    isControlling: formData.get('isControlling'),
                    feelsInferior: formData.get('feelsInferior'),
                    inferiorityReason: formData.get('inferiorityReason'),
                    doubtsCapacity: formData.get('doubtsCapacity'),
                    personality: formData.get('personality'),
                    feelsGuilty: formData.get('feelsGuilty'),
                    guiltReason: formData.get('guiltReason')
                };

                // Adicionar escala de sentimentos
                const feelings = [
                    'raiva', 'medodealgoconcretto', 'medosvagos', 'culpa', 'revolta', 'medodeperderochontrole',
                    'tristeza', 'magoa', 'orgulho', 'odio', 'egoismo', 'ansiedade', 'intolerancia', 'submissao',
                    'indecisao', 'desespero', 'desanimo', 'covardia', 'egocentrismo', 'ciume', 'frustracao',
                    'nostalgia', 'cansaco', 'impaciencia', 'angustia', 'timidez', 'apatia', 'ressentimento',
                    'solidao', 'autoritarismo'
                ];

                const feelingsData = {};
                feelings.forEach(feeling => {
                    const feelingValue = formData.get(`feeling_${feeling}`);
                    if (feelingValue) {
                        feelingsData[`feeling_${feeling}`] = feelingValue;
                    }
                });

                // Adicionar dados dos sentimentos
                Object.assign(patientData, feelingsData);

                // Data de cadastro/atualização
                if (!isEditMode) {
                    patientData.createdAt = new Date().toISOString();
                }
                patientData.updatedAt = new Date().toISOString();

                // Aguardar PatientManager
                if (!window.patientManager) {
                    await waitForPatientManager();
                }

                if (isEditMode) {
                    await window.patientManager.updatePatient(currentPatientId, patientData);
                } else {
                    await window.patientManager.addPatient(patientData);
                }

                // Mostrar sucesso e redirecionar
                showSuccess();
                setTimeout(() => {
                    window.location.href = 'pacientes.html';
                }, 2000);

            } catch (error) {
                console.error('Erro ao salvar paciente:', error);
                alert('Erro ao salvar paciente: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function validateForm() {
            const requiredFields = ['name', 'email', 'phone', 'birthDate', 'address'];
            let isValid = true;

            requiredFields.forEach(fieldId => {
                if (!validateField(fieldId)) {
                    isValid = false;
                }
            });

            if (!isValid) {
                alert('Por favor, corrija os erros no formulário antes de continuar.');
                // Scroll para o primeiro erro
                const firstError = document.querySelector('.form-group.invalid');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            return isValid;
        }

        function waitForPatientManager() {
            return new Promise((resolve) => {
                const checkInterval = setInterval(() => {
                    if (window.patientManager) {
                        clearInterval(checkInterval);
                        resolve();
                    }
                }, 100);
            });
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        function showSuccess() {
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            successMessage.scrollIntoView({ behavior: 'smooth' });
        }

        // Função global para mostrar alertas
        window.showAlert = function(message, type = 'info') {
            // Criar elemento de alerta temporário
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                max-width: 400px;
                padding: 1rem;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideInRight 0.3s ease;
            `;
            
            switch (type) {
                case 'success':
                    alert.style.background = '#2ecc71';
                    break;
                case 'error':
                    alert.style.background = '#e74c3c';
                    break;
                case 'warning':
                    alert.style.background = '#f39c12';
                    break;
                default:
                    alert.style.background = '#3498db';
            }
            
            alert.textContent = message;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        };
    </script>

    <style>
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</body>
</html>